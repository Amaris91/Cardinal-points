library(plotly)
library(readxl)
library(tidyverse)
install.packages("dplyr")
library(dplyr)
install.packages('tidyverse')
install.packages("ggplot2")
library(ggplot2)
library(mgcv)
library(mgcViz)
install.packages("readxl")
library(forcats)
library(tidypaleo)
install.packages("tidypaleo")
library(ggpubr)
install.packages("ggpubr")
install.packages("cowplot")
library(cowplot)
library(gridExtra)
library(grid) 
install.packages("devtools")
library(devtools)
library(tidyverse)
install.packages("broom")
library(broom)
install.packages("rstatix")
library(rstatix)
install.packages("qqplotr")
library(qqplotr)
install.packages("devtools")
library(devtools)
library(tidyverse)
install.packages("broom")
library(broom)
install.packages("rstatix")
library(rstatix)
install.packages("qqplotr")
library(qqplotr)
library(moments)
install.packages("moments")
library(multcomp)
install.packages("multcomp")
install.packages("multcompletters")
library(multcompletters)
install.packages("multcompView")
library(multcompView)



############Shapiro Wilk by RESIDUALS ###########################################

############ first need to compute the ANOVA #######################
#### then check qq plot, histogram for normal distribution################
######### Then do a SHAPIRO WILK on the residuals ##############################

Max_NP_PARsat.anova <- aov(Max_NP_PARsat ~ factor(Species), data = cardinal_points_github)
hist(Max_NP_PARsat.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(Max_NP_PARsat.anova$residuals)
summary(Max_NP_PARsat.anova)


Max_DR_PARsat.anova <- aov(Max_DR_PARsat ~ factor(Species), data = cardinal_points_github)
hist(Max_DR_PARsat.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(Max_DR_PARsat.anova$residuals)
summary(Max_DR_PARsat.anova)

LCP.anova <- aov(LCP~ factor(Species), data = cardinal_points_github)
hist(LCP.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(LCP.anova$residuals) 
summary(LCP.anova)

LSP.anova <- aov(LSP ~ factor(Species), data = cardinal_points_github)
hist(LSP.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(LSP.anova$residuals)
summary(LSP.anova)

WC_Min.anova <- aov(WC_Min ~ factor(Species), data = cardinal_points_github)
hist(WC_Min.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(WC_Min.anova$residuals)
summary(WC_Min.anova)

WC_Max.anova <- aov(WC_Max ~ factor(Species), data = cardinal_points_github)
hist(WC_Max.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(WC_Max.anova$residuals)
summary(WC_Max.anova)

WC_Optimal_Range.anova <- aov(WC_Optimal_Range ~ factor(Species), data = cardinal_points_github)
hist(WC_Optimal_Range.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(WC_Optimal_Range.anova$residuals)
summary(WC_Optimal_Range.anova)


Chl.anova <- aov(Chl ~ factor(Species), data = cardinal_points_github)
hist(Chl.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(Chl.anova$residuals)
summary(Chl.anova)


CGE.anova <- aov(CGE ~ factor(Species), data = cardinal_points_github)
hist(CGE.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(CGE.anova$residuals)
summary(CGE.anova)


#####################################################
#################### not plotting these ones in paper ##################################################


DR_WC_optimal.anova <- aov(DR_WC_optimal ~ factor(Species), data = cardinal_points_github)
hist(DR_WC_optimal.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(DR_WC_optimal.anova$residuals)
summary(DR_WC_optimal.anova)
TukeyHSD(DR_WC_optimal.anova)

NPDR.anova <- aov(NPDR_log ~ factor(Species), data = cardinal_points_github)
hist(NPDR.anova$residuals)  ########### checking that data follows normal distribution
qqnorm(NPDR.anova$residuals)
summary(NPDR.anova)
TukeyHSD(NPDR.anova)
######################################################################################



#########################################################################################
################Shapiro Wilk on RESIDUALS ##############################################

shapiro.test(Max_NP_PARsat.anova$residuals)

shapiro.test(Max_DR_PARsat.anova$residuals) 

shapiro.test(LCP.anova$residuals) 

shapiro.test(LSP.anova$residuals) 

shapiro.test(WC_Min.anova$residuals) 

shapiro.test(WC_Max.anova$residuals) 

shapiro.test(Chl.anova$residuals) 

shapiro.test(WC_Optimal_Range.anova$residuals) 

shapiro.test(CGE.anova$residuals) 




################ not plotting these ones in paper ################################################################
shapiro.test(NP_WC_optimal.anova$residuals) ## normal = 0.1158

shapiro.test(DR_WC_optimal.anova$residuals) ## not normal 0.5849

shapiro.test(NPDR.anova$residuals)

#################################################################################


#### if not normal distribution after S_W test, then need to transform data ###################################

############################ TRANSFORM ABNORMAL DATA #########################################
## TRANSFORMATIONS HAVE BEEN MADE TO ABOVE CODE ###############################

Max_NP_PARsat_log10 <-(log10(cardinal_points_githubE$Max_NP_PARsat))

LCP_log10 <- (log10(cardinal_points_github$LCP))

WC_Min_log10 <- (log10(cardinal_points_github$WC_Min))

WC_Max_log10 <- (log10(cardinal_points_github$WC_Max))

WC_Optimal_range_log10 <- (log10(cardinal_points_github$WC_Optimal_Range))

################################################################



#################################################################################################

################ redo ANOVA for logged data, so I can get RESIDUALS for new Shapiro-Wilk tests (these are not the final ANOVAS) ######################

Max_NP_PARsat.anova.log10 <- aov(Max_NP_PARsat_log10 ~ factor(Species), data = cardinal_points_github)

LCP.anova.log10 <- aov(LCP_log10~ factor(Species), data = cardinal_points_github)

WC_Min.anova.log10 <- aov(WC_Min_log10 ~ factor(Species), data = cardinal_points_github)

WC_Max.anova.log10 <- aov(WC_Max_log10 ~ factor(Species), data = cardinal_points_github)

WC_optimal.range.anova.log10 <- aov(WC_Optimal_range_log10 ~ factor(Species), data = cardinal_points_github)



########### S-W on logged data ####################

shapiro.test(Max_NP_PARsat.anova.log10$residuals)## now all these are above 0.05 

shapiro.test(LCP.anova.log10$residuals) ## = 

shapiro.test(WC_Min.anova.log10$residuals) ## 

shapiro.test(WC_Max.anova.log10$residuals) 

shapiro.test(WC_optimal.range.anova.log10$residuals) 

##################################################################


########## ANOVAs ####################################
############################ ANOVAS #############
########## ANOVAS #########################################

Max_NP_PARsat.anova <- aov(Max_NP_PARsat_log10  ~ factor(Species), data = cardinal_points_github)
summary(Max_NP_PARsat.anova.log10)


Max_DR_PARsat.anova <- aov(Max_DR_PARsat ~ factor(Species), data = cardinal_points_github)
summary(Max_DR_PARsat.anova)


LCP.anova <- aov(LCP_log10~ factor(Species), data = cardinal_points_github)
summary(LCP.anova)


LSP.anova <- aov(LSP ~ factor(Species), data = cardinal_points_github)
summary(LSP.anova)

WC_Min.anova <- aov(WC_Min_log10 ~ factor(Species), data = cardinal_points_github)
summary(WC_Min.anova)


WC_Max.anova <- aov(WC_Max_log10 ~ factor(Species), data = cardinal_points_github)
summary(WC_Max.anova)

WC_optimal.range.anova <- aov(WC_Optimal_range_log10 ~ factor(Species), data = cardinal_points_github)
summary(WC_optimal.range.anova)


Chl.anova <- aov(Chl ~ factor(Species), data = cardinal_points_github)
summary(Chl.anova)

CGE.anova <- aov(CGE ~ factor(Species), data = cardinal_points_github)
summary(NPDR.anova)


################### then TUKEY POST HOC TEST - to see where differences lie #########################

tukeyNP.par.sat <- TukeyHSD(Max_NP_PARsat.anova)

tukeyDR.par.sat <- TukeyHSD(Max_DR_PARsat.anova)

tukeyLCP <-TukeyHSD(LCP.anova)

tukeyLSP <- TukeyHSD(LSP.anova)

tukey.WC.min <- TukeyHSD(WC_Min.anova.log10)

tukey.WC.max <- TukeyHSD(WC_Max.anova)

tukey.WC.optimal.range <- TukeyHSD(WC_optimal.range.anova)

tukey.chl <- TukeyHSD(Chl.anova)

tukey.CGE <- TukeyHSD(CGE.anova)


########### Generate CLD letter of significance - without Rv ########################################

cld.NP.par.sat <- multcompLetters4(Max_NP_PARsat.anova ,tukeyNP.par.sat)
print(cld.NP.par.sat)

cldDR.par.sat <- multcompLetters4(Max_DR_PARsat.anova,tukeyDR.par.sat)
print(cldDR.par.sat)

cldLCP <- multcompLetters4(LCP.anova,tukeyLCP)
print(cldLCP)

cldLSP <- multcompLetters4(LSP.anova,tukeyLSP)
print(cldLSP)

cld.WC.min <- multcompLetters4(WC_Min.anova,tukey.WC.min)
print(cld.WC.min)

cld.WC.max <- multcompLetters4(WC_Max.anova,tukey.WC.max)
print(cld.WC.max)

cld.Chl <- multcompLetters4(Chl.anova,tukey.chl)
print(cld.Chl)

cld.WC.optimal.range <- multcompLetters4(WC_optimal.range.anova,tukey.WC.optimal.range)
print(cld.WC.optimal.range)

cld.CGE<- multcompLetters4(NPDR.anova,tukey.CGE)
print(cld.NPDR)
















